---
import Layout from "@/layouts/Layout.astro";
import Button from "@/components/ui/button.astro";
---

<Layout title="Coming Soon" footerMargin={false}>
  <main class="flex-1 flex items-center justify-center bg-white min-h-[calc(100vh-200px)]">
    <div class="max-w-2xl mx-auto px-6 py-16 text-center">
      <!-- Coming Soon Badge -->
      <div class="mb-8">
        <span class="inline-block px-4 py-2 bg-emerald-100 text-emerald-700 rounded-full text-sm font-medium">
          Coming Soon
        </span>
      </div>

      <!-- Main Headline -->
      <h1 class="text-5xl lg:text-6xl xl:text-7xl font-bold lg:tracking-tight xl:tracking-tighter mb-6">
        Your AI. Your Data.
        <span class="relative inline-block align-baseline">
          <span
            class="rounded px-1"
            style="background: linear-gradient(90deg, #10b98126, #10b9811A)">
            Your Rules.
          </span>
          <svg
            aria-hidden="true"
            class="pointer-events-none absolute left-0 -bottom-1 w-full h-[10px] text-emerald-500/70"
            viewBox="0 0 100 10"
            preserveAspectRatio="none">
            <path
              d="M2 8 C 20 2, 40 12, 58 6 S 90 2, 98 6"
              fill="none"
              stroke="currentColor"
              stroke-width="2.5"
              stroke-linecap="round"></path>
          </svg>
        </span>
      </h1>

      <!-- Subtext -->
      <p class="text-lg md:text-xl text-gray-600 mb-12 max-w-lg mx-auto">
        Sovereign AI infrastructure for enterprises. Stay tuned for something extraordinary.
      </p>

      <!-- Newsletter Form -->
      <div class="bg-white rounded-2xl shadow-lg p-8 max-w-md mx-auto">
        <h2 class="text-xl font-semibold text-gray-900 mb-2">
          Stay Updated
        </h2>
        <p class="text-gray-600 mb-6 text-sm">
          Be the first to know when we launch.
        </p>

        <form
          id="newsletter-form"
          class="needs-validation"
          novalidate>
          <input type="checkbox" class="hidden" style="display:none" name="botcheck" />

          <div class="flex flex-col gap-3">
            <div>
              <label for="newsletter_email" class="sr-only">Email Address</label>
              <input
                id="newsletter_email"
                type="email"
                placeholder="Enter your email"
                name="email"
                required
                class="w-full px-4 py-3 border-2 placeholder:text-gray-500 rounded-lg outline-hidden focus:ring-4 border-gray-200 focus:border-emerald-600 ring-emerald-100"
              />
              <div class="empty-feedback text-red-500 text-sm mt-1 text-left">
                Please provide your email address.
              </div>
              <div class="invalid-feedback text-red-500 text-sm mt-1 text-left">
                Please provide a valid email address.
              </div>
            </div>
            <Button type="submit" size="lg" block>
              Notify Me
            </Button>
          </div>

          <div id="newsletter-result" class="mt-3 text-sm"></div>
        </form>
      </div>
    </div>
  </main>
</Layout>

<style>
  .invalid-feedback,
  .empty-feedback {
    display: none;
  }

  .was-validated :placeholder-shown:invalid ~ .empty-feedback {
    display: block;
  }

  .was-validated :not(:placeholder-shown):invalid ~ .invalid-feedback {
    display: block;
  }

  .is-invalid,
  .was-validated :invalid {
    border-color: #dc3545;
  }
</style>

<script is:inline>
  document.addEventListener(
    "astro:page-load",
    () => {
      const form = document.getElementById("newsletter-form");
      const result = document.getElementById("newsletter-result");

      if (!form || !result) return;

      form.addEventListener("submit", async function (e) {
        e.preventDefault();
        form.classList.add("was-validated");

        if (!form.checkValidity()) {
          form.querySelectorAll(":invalid")[0]?.focus();
          return;
        }

        const formData = new FormData(form);
        const email = formData.get("email");

        result.textContent = "Subscribing...";
        result.className = "mt-3 text-sm text-gray-600";

        try {
          const response = await fetch("/api/newsletter", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ email }),
          });

          const data = await response.json();

          if (data.success) {
            result.className = "mt-3 text-sm text-green-600 font-medium";
            result.textContent = data.message;
            form.reset();
            form.classList.remove("was-validated");
          } else {
            result.className = "mt-3 text-sm text-red-500";
            result.textContent = data.message;
          }
        } catch (error) {
          console.error(error);
          result.className = "mt-3 text-sm text-red-500";
          result.textContent = "Something went wrong. Please try again.";
        }

        setTimeout(() => {
          result.style.display = "none";
        }, 5000);
      });
    },
    { once: true }
  );
</script>
